---
title: "MIMIC example diagnostics"
author: "Andrew Manderson"
date: "`r format(Sys.time(), '%d %B, %Y')`"
fontfamily: tgpagella
fontsize: 10pt
papersize: a4
geometry: margin=2.25cm
bibliography: ../bibliography/multi-phi-bib.bib
csl: ../bibliography/journal-of-the-royal-statistical-society.csl
link-citations: true
hyperrefoptions:
  - backref
  - colorlinks=true
output:
  html_document:
    code_folding: hide
---

<script src="js/hideAll.js"></script>

\newcommand{\pd}{\text{p}}

<!--
Rscript -e 'rmarkdown::render("rmd-reports/2021-06-15_diagnosis-issues.rmd")'
-->

```{r setup, include = FALSE, cache = FALSE, message = FALSE, warning = FALSE, comment = NA}
options(width = 9999)
knitr::opts_chunk$set(
  echo = FALSE,
  cache = TRUE,
  fig.align = 'center',
  fig.width = 12,
  fig.height = 7,
  out.extra = 'class="plot"'
)
```

```{css, echo = FALSE}
.showopt {
  background-color: #004c93;
  color: #FFFFFF;
  width: 100px;
  height: 20px;
  text-align: center;
  vertical-align: middle !important;
  float: left;
  font-family: sans-serif;
  border-radius: 8px;
}

.showopt:hover {
    background-color: #dfe4f2;
    color: #004c93;
}

pre.plot {
  background-color: white !important;
}
```

```{r defs_includes, message = FALSE, warning = FALSE, comment = NA, cache = FALSE}
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(rstan))
suppressPackageStartupMessages(library(kableExtra))

local_monitor <- function(x) {
  rstan::monitor(
    sims = x,
    warmup = 1,
    probs = c(0.01, 0.025, 0.10, 0.5, 0.9, 0.975, 0.99),
    print = FALSE,
    digits_summary = 2
  ) %>%
    as.data.frame() %>%
    tibble::rownames_to_column() %>%
    as_tibble() %>%
    relocate(mean, sd, n_eff, Rhat, Bulk_ESS, Tail_ESS, valid, .before = se_mean) %>% 
    arrange(desc(Rhat))
}

local_styling <- function(x) {
  kbl(x) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  scroll_box(width = '100%', height = '300px')
}

source("../scripts/common/plot-settings.R")

log_full_psi_2 <- readRDS('../rds/mimic-example/stage-two-log-psi-2-samples.rds')
log_full_phi_23 <- readRDS('../rds/mimic-example/stage-two-log-phi-23-samples.rds')
log_full_phi_12 <- readRDS('../rds/mimic-example/stage-two-log-phi-12-samples.rds')

breakpoint_names <- dimnames(log_full_phi_23)[[3]] %>%
  grep(pattern = 'breakpoint', x = ., value = TRUE)

eta_before_names <- dimnames(log_full_phi_23)[[3]] %>%
  grep(pattern = '\\,1\\]', x = ., value = TRUE)

eta_after_names <- dimnames(log_full_phi_23)[[3]] %>%
  grep(pattern = '\\,2\\]', x = ., value = TRUE)

event_time_names <- dimnames(log_full_phi_12)[[3]] %>%
  grep(pattern = 'time', x = ., value = TRUE)

event_indicator_names <- dimnames(log_full_phi_12)[[3]] %>%
  grep(pattern = 'indicator', x = ., value = TRUE)

n_icu_stays <- length(breakpoint_names)
```

# Reference, fitted values plot

- This plot is included so we can see why the event times or fluid model parameters are what they are

```{r fit_plot, cache.extra = paste0(tools::md5sum('../plots/mimic-example/combined-pf-fluid-fit-plot.png'), collapse = '')}
knitr::include_graphics('../plots/mimic-example/combined-pf-fluid-fit-plot.png')
```

# Stage 1

```{r stage_one_reads, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/submodel-1-event-times-samples-array.rds', '../rds/mimic-example/submodel-3-fluid-samples-array.rds')), collapse = '')}
stage_one_phi_12_samples <- readRDS('../rds/mimic-example/submodel-1-event-times-samples-array.rds')
stage_one_phi_23_samples <- readRDS('../rds/mimic-example/submodel-3-fluid-samples-array.rds')
```

## Submodel 1 - PF

### $\psi_{1}$

#### $\omega_{i}$

```{r stage_one_psi_1_omega, cache.extra = paste0(tools::md5sum('../rds/mimic-example/submodel-1-pf-samples-array.rds'), collapse = '')}
stage_one_psi_1_samples <- readRDS('../rds/mimic-example/submodel-1-pf-samples-array.rds')
omega_names <- names(stage_one_psi_1_samples[1, 1, ]) %>%
  grep(pattern = 'y_sigma', x = ., value = TRUE)

mcmc_trace(stage_one_psi_1_samples[, , omega_names])
stage_one_psi_1_samples[, , omega_names] %>%
  local_monitor() %>%
  local_styling()
```

#### $\beta_{0, i}$

```{r stage_one_psi_1_beta_zero, cache.extra = paste0(tools::md5sum('../rds/mimic-example/submodel-1-pf-samples-array.rds'), collapse = '')}
stage_one_psi_1_samples <- readRDS('../rds/mimic-example/submodel-1-pf-samples-array.rds')
beta_zero_names <- names(stage_one_psi_1_samples[1, 1, ]) %>%
  grep(pattern = 'beta_zero', x = ., value = TRUE)

mcmc_trace(stage_one_psi_1_samples[, , beta_zero_names])
stage_one_psi_1_samples[, , beta_zero_names] %>%
  local_monitor() %>%
  local_styling()
```

#### $\boldsymbol{\zeta}_{i}$

There are too many of these to look at, so each time we re-run this file we'll look at a different individual.

```{r stage_one_psi_1_zeta, cache.extra = paste0(tools::md5sum('../rds/mimic-example/submodel-1-pf-samples-array.rds'), collapse = '')}
stage_one_psi_1_samples <- readRDS('../rds/mimic-example/submodel-1-pf-samples-array.rds')
zeta_rand_i_names <- sprintf(
  'spline_coef[%d,%d]',
  sample(1 : n_icu_stays, 1),
  1 : 10
)

mcmc_trace(stage_one_psi_1_samples[, , zeta_rand_i_names])
stage_one_psi_1_samples[, , zeta_rand_i_names] %>%
  local_monitor() %>%
  local_styling()
```

### $\phi_{1 \cap 2}$

#### Event times $T_{i}$

```{r stage_one_phi_12_times, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/submodel-1-event-times-samples-array.rds')), collapse = '')}
mcmc_trace(stage_one_phi_12_samples[, , event_time_names])
stage_one_phi_12_samples[, , event_time_names] %>%
  local_monitor() %>%
  local_styling()
```

#### Event indicators $d_{i}$

```{r stage_one_phi_12_indicators, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/submodel-1-event-times-samples-array.rds')), collapse = '')}
mcmc_trace(stage_one_phi_12_samples[, , event_indicator_names])
stage_one_phi_12_samples[, , event_indicator_names] %>%
  local_monitor() %>%
  local_styling()
```

## Submodel 3 - Fluids

### $\psi_{3}$

#### $\sigma_{x, i}$

```{r stage_one_psi_3_sigma_x, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/submodel-1-event-times-samples-array.rds')), collapse = '')}
stage_one_psi_3_samples <- readRDS('../rds/mimic-example/submodel-3-fluid-samples-array.rds')
sigma_x_names <- names(stage_one_psi_3_samples[1, 1, ]) %>%
  grep(pattern = 'y_sigma', x = ., value = TRUE)

mcmc_trace(stage_one_psi_3_samples[, , sigma_x_names])
stage_one_psi_3_samples[, , sigma_x_names] %>%
  local_monitor() %>%
  local_styling()
```

#### $\eta_{0, i}$

```{r stage_one_psi_3_eta_zero, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/submodel-1-event-times-samples-array.rds')), collapse = '')}
stage_one_psi_3_samples <- readRDS('../rds/mimic-example/submodel-3-fluid-samples-array.rds')
eta_zero_names <- names(stage_one_psi_3_samples[1, 1, ]) %>%
  grep(pattern = 'eta_zero', x = ., value = TRUE)

mcmc_trace(stage_one_psi_3_samples[, , eta_zero_names])
stage_one_psi_3_samples[, , eta_zero_names] %>%
  local_monitor() %>%
  local_styling()
```

### $\phi_{2 \cap 3}$

#### Breakpoint $\kappa$

```{r stage_one_phi_23_breakpoints, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/submodel-3-fluid-samples-array.rds')), collapse = '')}
mcmc_trace(stage_one_phi_23_samples[, , breakpoint_names])
stage_one_phi_23_samples[, , breakpoint_names] %>%
  local_monitor() %>%
  local_styling()
```

#### Slope before $\eta_{1, i}^{b}$

- ~~something up with `eta_slope[7, 1]`~~

```{r stage_one_phi_23_eta_befores, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/submodel-3-fluid-samples-array.rds')), collapse = '')}
mcmc_trace(stage_one_phi_23_samples[, , eta_before_names])
stage_one_phi_23_samples[, , eta_before_names] %>%
  local_monitor() %>%
  local_styling()
```

#### Slope after $\eta_{1, i}^{a}$

```{r stage_one_phi_23_eta_afters, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/submodel-3-fluid-samples-array.rds')), collapse = '')}
mcmc_trace(stage_one_phi_23_samples[, , eta_after_names])
stage_one_phi_23_samples[, , eta_after_names] %>%
  local_monitor() %>%
  local_styling()
```

# Stage 2

## PoE

### None (full melding)

```{r stage_two_poe_none_fixed_reads, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-psi-2-samples.rds', '../rds/mimic-example/stage-two-poe-phi-12-samples.rds', '../rds/mimic-example/stage-two-poe-phi-23-samples.rds')), collapse = '')}
stage_two_poe_none_fixed_psi_2_samples <- readRDS('../rds/mimic-example/stage-two-poe-psi-2-samples.rds')
stage_two_poe_none_fixed_phi_12_samples <- readRDS('../rds/mimic-example/stage-two-poe-phi-12-samples.rds')
stage_two_poe_none_fixed_phi_23_samples <- readRDS('../rds/mimic-example/stage-two-poe-phi-23-samples.rds')
```

#### $\phi_{1 \cap 2}$

##### Event times $T_{i}$

```{r stage_two_poe_none_fixed_times, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-phi-12-samples.rds')), collapse = '')}
mcmc_trace(stage_two_poe_none_fixed_phi_12_samples[, , event_time_names])
stage_two_poe_none_fixed_phi_12_samples[, , event_time_names] %>%
  local_monitor() %>%
  local_styling()
```

##### Event indicators $d_{i}$

```{r stage_two_poe_none_fixed_indicators, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-phi-12-samples.rds')), collapse = '')}
mcmc_trace(stage_two_poe_none_fixed_phi_12_samples[, , event_indicator_names])
stage_two_poe_none_fixed_phi_12_samples[, , event_indicator_names] %>%
  local_monitor() %>%
  local_styling()
```

#### $\phi_{2 \cap 3}$

##### Breakpoint $\kappa$

```{r stage_two_poe_none_fixed_breakpoints, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-phi-23-samples.rds')), collapse = '')}
mcmc_trace(stage_two_poe_none_fixed_phi_23_samples[, , breakpoint_names])
stage_two_poe_none_fixed_phi_23_samples[, , breakpoint_names] %>%
  local_monitor() %>%
  local_styling()
```

##### Slope before $\eta_{1, i}^{b}$

```{r stage_two_poe_none_fixed_eta_befores, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-phi-23-samples.rds')), collapse = '')}
mcmc_trace(stage_two_poe_none_fixed_phi_23_samples[, , eta_before_names])
stage_two_poe_none_fixed_phi_23_samples[, , eta_before_names] %>%
  local_monitor() %>%
  local_styling()
```

##### Slope after $\eta_{1, i}^{a}$

```{r stage_two_poe_none_fixed_eta_afters, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-phi-23-samples.rds')), collapse = '')}
mcmc_trace(stage_two_poe_none_fixed_phi_23_samples[, , eta_after_names])
stage_two_poe_none_fixed_phi_23_samples[, , eta_after_names] %>%
  local_monitor() %>%
  local_styling()
```

#### $\psi_{2}$

```{r stage_two_poe_none_fixed_psi_2, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-psi-2-samples.rds')), collapse = '')}
mcmc_trace(stage_two_poe_none_fixed_psi_2_samples)
stage_two_poe_none_fixed_psi_2_samples %>%
  local_monitor() %>%
  local_styling()
```

### Fix $\phi_{1 \cap 2}$

```{r stage_two_poe_fix_phi_12_reads, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-psi-2-samples-fix-phi-12-meld-phi-23.rds', '../rds/mimic-example/stage-two-poe-phi-23-samples-fix-phi-12-meld-phi-23.rds')), collapse = '')}
stage_two_poe_fix_phi_12_psi_2_samples <- readRDS('../rds/mimic-example/stage-two-poe-psi-2-samples-fix-phi-12-meld-phi-23.rds')
stage_two_poe_fix_phi_12_phi_23_samples <- readRDS('../rds/mimic-example/stage-two-poe-phi-23-samples-fix-phi-12-meld-phi-23.rds')
```

#### $\phi_{2 \cap 3}$

##### Breakpoint $\kappa$

```{r stage_two_poe_fix_phi_12_breakpoints, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-phi-23-samples-fix-phi-12-meld-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_poe_fix_phi_12_phi_23_samples[, , breakpoint_names])
stage_two_poe_fix_phi_12_phi_23_samples[, , breakpoint_names] %>%
  local_monitor() %>%
  local_styling()
```

##### Slope before $\eta_{1, i}^{b}$

```{r stage_two_poe_fix_phi_12_eta_befores, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-phi-23-samples-fix-phi-12-meld-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_poe_fix_phi_12_phi_23_samples[, , eta_before_names])
stage_two_poe_fix_phi_12_phi_23_samples[, , eta_before_names] %>%
  local_monitor() %>%
  local_styling()
```

##### Slope after $\eta_{1, i}^{a}$

```{r stage_two_poe_fix_phi_12_eta_afters, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-phi-23-samples-fix-phi-12-meld-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_poe_fix_phi_12_phi_23_samples[, , eta_after_names])
stage_two_poe_fix_phi_12_phi_23_samples[, , eta_after_names] %>%
  local_monitor() %>%
  local_styling()
```

#### $\psi_{2}$

```{r stage_two_poe_fix_phi_12_psi_2, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-psi-2-samples-fix-phi-12-meld-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_poe_fix_phi_12_psi_2_samples)
stage_two_poe_fix_phi_12_psi_2_samples %>%
  local_monitor() %>%
  local_styling()
```

### Fix $\phi_{2 \cap 3}$

```{r stage_two_poe_fix_phi_23_reads, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-psi-2-samples-meld-phi-12-fix-phi-23.rds', '../rds/mimic-example/stage-two-poe-phi-12-samples-meld-phi-12-fix-phi-23.rds')), collapse = '')}
stage_two_poe_fix_phi_23_psi_2_samples <- readRDS('../rds/mimic-example/stage-two-poe-psi-2-samples-meld-phi-12-fix-phi-23.rds')
stage_two_poe_fix_phi_23_phi_12_samples <- readRDS('../rds/mimic-example/stage-two-poe-phi-12-samples-meld-phi-12-fix-phi-23.rds')
```

#### $\phi_{1 \cap 2}$

##### Event times $T_{i}$

```{r stage_two_poe_fix_phi_23_times, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-phi-12-samples-meld-phi-12-fix-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_poe_fix_phi_23_phi_12_samples[, , event_time_names])
stage_two_poe_fix_phi_23_phi_12_samples[, , event_time_names] %>%
  local_monitor() %>%
  local_styling()
```

##### Event indicators $d_{i}$

```{r stage_two_poe_fix_phi_23_indicators, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-phi-12-samples-meld-phi-12-fix-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_poe_fix_phi_23_phi_12_samples[, , event_indicator_names])
stage_two_poe_fix_phi_23_phi_12_samples[, , event_indicator_names] %>%
  local_monitor() %>%
  local_styling()
```

#### $\psi_{2}$

```{r stage_two_poe_fix_phi_23_psi_2, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-poe-psi-2-samples-meld-phi-12-fix-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_poe_fix_phi_23_psi_2_samples)
stage_two_poe_fix_phi_23_psi_2_samples %>%
  local_monitor() %>%
  local_styling()
```

## Log

### None (full melding)

```{r stage_two_log_none_fixed_reads, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-psi-2-samples.rds', '../rds/mimic-example/stage-two-log-phi-12-samples.rds', '../rds/mimic-example/stage-two-log-phi-23-samples.rds')), collapse = '')}
stage_two_log_none_fixed_psi_2_samples <- readRDS('../rds/mimic-example/stage-two-log-psi-2-samples.rds')
stage_two_log_none_fixed_phi_12_samples <- readRDS('../rds/mimic-example/stage-two-log-phi-12-samples.rds')
stage_two_log_none_fixed_phi_23_samples <- readRDS('../rds/mimic-example/stage-two-log-phi-23-samples.rds')
```

#### $\phi_{1 \cap 2}$

##### Event times $T_{i}$

```{r stage_two_log_none_fixed_times, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-phi-12-samples.rds')), collapse = '')}
mcmc_trace(stage_two_log_none_fixed_phi_12_samples[, , event_time_names])
stage_two_log_none_fixed_phi_12_samples[, , event_time_names] %>%
  local_monitor() %>%
  local_styling()
```

##### Event indicators $d_{i}$

```{r stage_two_log_none_fixed_indicators, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-phi-12-samples.rds')), collapse = '')}
mcmc_trace(stage_two_log_none_fixed_phi_12_samples[, , event_indicator_names])
stage_two_log_none_fixed_phi_12_samples[, , event_indicator_names] %>%
  local_monitor() %>%
  local_styling()
```

#### $\phi_{2 \cap 3}$

##### Breakpoint $\kappa$

```{r stage_two_log_none_fixed_breakpoints, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-phi-23-samples.rds')), collapse = '')}
mcmc_trace(stage_two_log_none_fixed_phi_23_samples[, , breakpoint_names])
stage_two_log_none_fixed_phi_23_samples[, , breakpoint_names] %>%
  local_monitor() %>%
  local_styling()
```

##### Slope before $\eta_{1, i}^{b}$

```{r stage_two_log_none_fixed_eta_befores, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-phi-23-samples.rds')), collapse = '')}
mcmc_trace(stage_two_log_none_fixed_phi_23_samples[, , eta_before_names])
stage_two_log_none_fixed_phi_23_samples[, , eta_before_names] %>%
  local_monitor() %>%
  local_styling()
```

##### Slope after $\eta_{1, i}^{a}$

```{r stage_two_log_none_fixed_eta_afters, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-phi-23-samples.rds')), collapse = '')}
mcmc_trace(stage_two_log_none_fixed_phi_23_samples[, , eta_after_names])
stage_two_log_none_fixed_phi_23_samples[, , eta_after_names] %>%
  local_monitor() %>%
  local_styling()
```

#### $\psi_{2}$

```{r stage_two_log_none_fixed_psi_2, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-psi-2-samples.rds')), collapse = '')}
mcmc_trace(stage_two_log_none_fixed_psi_2_samples)
stage_two_log_none_fixed_psi_2_samples %>%
  local_monitor() %>%
  local_styling()
```

### Fix $\phi_{1 \cap 2}$

```{r stage_two_log_fix_phi_12_reads, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-psi-2-samples-fix-phi-12-meld-phi-23.rds', '../rds/mimic-example/stage-two-log-phi-23-samples-fix-phi-12-meld-phi-23.rds')), collapse = '')}
stage_two_log_fix_phi_12_psi_2_samples <- readRDS('../rds/mimic-example/stage-two-log-psi-2-samples-fix-phi-12-meld-phi-23.rds')
stage_two_log_fix_phi_12_phi_23_samples <- readRDS('../rds/mimic-example/stage-two-log-phi-23-samples-fix-phi-12-meld-phi-23.rds')
```

#### $\phi_{2 \cap 3}$

##### Breakpoint $\kappa$

```{r stage_two_log_fix_phi_12_breakpoints, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-phi-23-samples-fix-phi-12-meld-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_log_fix_phi_12_phi_23_samples[, , breakpoint_names])
stage_two_log_fix_phi_12_phi_23_samples[, , breakpoint_names] %>%
  local_monitor() %>%
  local_styling()
```

##### Slope before $\eta_{1, i}^{b}$

```{r stage_two_log_fix_phi_12_eta_befores, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-phi-23-samples-fix-phi-12-meld-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_log_fix_phi_12_phi_23_samples[, , eta_before_names])
stage_two_log_fix_phi_12_phi_23_samples[, , eta_before_names] %>%
  local_monitor() %>%
  local_styling()
```

##### Slope after $\eta_{1, i}^{a}$

```{r stage_two_log_fix_phi_12_eta_afters, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-phi-23-samples-fix-phi-12-meld-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_log_fix_phi_12_phi_23_samples[, , eta_after_names])
stage_two_log_fix_phi_12_phi_23_samples[, , eta_after_names] %>%
  local_monitor() %>%
  local_styling()
```

#### $\psi_{2}$

```{r stage_two_log_fix_phi_12_psi_2, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-psi-2-samples-fix-phi-12-meld-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_log_fix_phi_12_psi_2_samples)
stage_two_log_fix_phi_12_psi_2_samples %>%
  local_monitor() %>%
  local_styling()
```

### Fix $\phi_{2 \cap 3}$


```{r stage_two_log_fix_phi_23_reads, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-psi-2-samples-meld-phi-12-fix-phi-23.rds', '../rds/mimic-example/stage-two-log-phi-12-samples-meld-phi-12-fix-phi-23.rds')), collapse = '')}
stage_two_log_fix_phi_23_psi_2_samples <- readRDS('../rds/mimic-example/stage-two-log-psi-2-samples-meld-phi-12-fix-phi-23.rds')
stage_two_log_fix_phi_23_phi_12_samples <- readRDS('../rds/mimic-example/stage-two-log-phi-12-samples-meld-phi-12-fix-phi-23.rds')
```

#### $\phi_{1 \cap 2}$

##### Event times $T_{i}$

```{r stage_two_log_fix_phi_23_times, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-phi-12-samples-meld-phi-12-fix-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_log_fix_phi_23_phi_12_samples[, , event_time_names])
stage_two_log_fix_phi_23_phi_12_samples[, , event_time_names] %>%
  local_monitor() %>%
  local_styling()
```

##### Event indicators $d_{i}$

```{r stage_two_log_fix_phi_23_indicators, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-phi-12-samples-meld-phi-12-fix-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_log_fix_phi_23_phi_12_samples[, , event_indicator_names])
stage_two_log_fix_phi_23_phi_12_samples[, , event_indicator_names] %>%
  local_monitor() %>%
  local_styling()
```

#### $\psi_{2}$

```{r stage_two_log_fix_phi_23_psi_2, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-log-psi-2-samples-meld-phi-12-fix-phi-23.rds')), collapse = '')}
mcmc_trace(stage_two_log_fix_phi_23_psi_2_samples)
stage_two_log_fix_phi_23_psi_2_samples %>%
  local_monitor() %>%
  local_styling()
```

## Point (marginal median value)

```{r both_fixed_reads, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-median-inputs-psi-2-samples.rds')), collapse = '')}
both_fixed_psi_2_samples <- readRDS('../rds/mimic-example/stage-two-median-inputs-psi-2-samples.rds')
```

#### $\psi_{2}$

```{r both_fixed_psi_2_samples, cache.extra = paste0(tools::md5sum(c('../rds/mimic-example/stage-two-median-inputs-psi-2-samples.rds')), collapse = '')}
mcmc_trace(both_fixed_psi_2_samples)
both_fixed_psi_2_samples %>%
  local_monitor() %>%
  local_styling()
```

